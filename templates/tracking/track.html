{% extends 'base.html' %}
{% load i18n %}

{% block title %}{% trans "Track Package" %}{% endblock %}

{% block content %}
<div class="card" style="max-width: 800px; margin: 2rem auto;">
    <h2 class="mb-4">{% trans "Track Package" %}</h2>

    <form method="get" class="flex mb-4" style="gap: 0.5rem;">
        <input type="text" name="tracking_number" value="{{ tracking_number|default:'' }}"
            placeholder="{% trans 'Enter tracking number' %}" required>
        <button type="submit" class="btn btn-primary">{% trans "Track" %}</button>
    </form>

    {% if package %}
    <div class="package-details">
        <div class="flex justify-between items-center mb-4">
            <h3>{{ package.tracking_number }}</h3>
            <span class="badge badge-info">{{ package.get_status_display }}</span>
        </div>

        <div class="grid grid-cols-2 mb-4">
            <div>
                <strong>{% trans "Sender" %}:</strong><br>
                {{ package.sender.username }}
            </div>
            <div>
                <strong>{% trans "Receiver" %}:</strong><br>
                {{ package.receiver_name }}<br>
                {{ package.receiver_address }}
            </div>
        </div>

        {% if package.status == 'DELIVERED' or package.signature %}
        <div class="mb-4 p-4 bg-gray-50 rounded"
            style="background-color: #f8f9fa; border: 1px solid var(--border-color);">
            <h4 class="mb-2">{% trans "Proof of Delivery" %}</h4>
            {% if package.signed_by %}
            <p><strong>{% trans "Signed By" %}:</strong> {{ package.signed_by }}</p>
            {% endif %}
            {% if package.signature %}
            <div class="mt-2">
                <img src="{{ package.signature.url }}" alt="{% trans 'Signature' %}"
                    style="max-width: 200px; border: 1px solid #ddd;">
            </div>
            {% endif %}
        </div>
        {% endif %}

        <h4 class="mt-4 mb-4">{% trans "Tracking History" %}</h4>
        <div class="timeline">
            {% for event in package.events.all|dictsortreversed:"timestamp" %}
            <div class="timeline-item"
                style="border-left: 2px solid var(--border-color); padding-left: 1rem; padding-bottom: 1.5rem; position: relative;">
                <div
                    style="position: absolute; left: -5px; top: 0; width: 8px; height: 8px; border-radius: 50%; background-color: var(--primary-color);">
                </div>
                <div class="text-secondary" style="font-size: 0.875rem;">{{ event.timestamp|date:"Y/m/d H:i" }}</div>
                <div style="font-weight: 600;">{{ event.get_status_display }}</div>
                <div>{{ event.location }}</div>
                {% if event.description %}
                <div class="text-secondary">{{ event.description }}</div>
                {% endif %}
            </div>
            {% empty %}
            <p>{% trans "No tracking history found." %}</p>
            {% endfor %}
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}