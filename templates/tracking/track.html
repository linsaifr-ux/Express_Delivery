{% extends 'base.html' %}

{% block title %}追蹤包裹{% endblock %}

{% block content %}
<div class="card" style="max-width: 800px; margin: 2rem auto;">
    <h2 class="mb-4">追蹤包裹</h2>

    <form method="get" class="flex mb-4" style="gap: 0.5rem;">
        <input type="text" name="tracking_number" value="{{ tracking_number|default:'' }}" placeholder="輸入追蹤號碼"
            required>
        <button type="submit" class="btn btn-primary">追蹤</button>
    </form>

    {% if package %}
    <div class="package-details">
        <div class="flex justify-between items-center mb-4">
            <h3>{{ package.tracking_number }}</h3>
            <span class="badge badge-info">{{ package.get_status_display }}</span>
        </div>

        <div class="grid grid-cols-2 mb-4">
            <div>
                <strong>寄件人:</strong><br>
                {{ package.sender.username }}
            </div>
            <div>
                <strong>收件人:</strong><br>
                {{ package.receiver_name }}<br>
                {{ package.receiver_address }}
            </div>
        </div>

        <h4 class="mt-4 mb-4">追蹤紀錄</h4>
        <div class="timeline">
            {% for event in package.events.all|dictsortreversed:"timestamp" %}
            <div class="timeline-item"
                style="border-left: 2px solid var(--border-color); padding-left: 1rem; padding-bottom: 1.5rem; position: relative;">
                <div
                    style="position: absolute; left: -5px; top: 0; width: 8px; height: 8px; border-radius: 50%; background-color: var(--primary-color);">
                </div>
                <div class="text-secondary" style="font-size: 0.875rem;">{{ event.timestamp|date:"Y年m月d日 H:i" }}</div>
                <div style="font-weight: 600;">{{ event.get_status_display }}</div>
                <div>{{ event.location }}</div>
                {% if event.description %}
                <div class="text-secondary">{{ event.description }}</div>
                {% endif %}
            </div>
            {% empty %}
            <p>查無追蹤紀錄。</p>
            {% endfor %}
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}